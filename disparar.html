<!DOCTYPE html>
<html>
<body>
    <div id="status">Processando...</div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAJaG7s34jBoU61fNNZieeV3N6lh9_3vo4",
            authDomain: "mercado-c3e95.firebaseapp.com",
            projectId: "mercado-c3e95",
            storageBucket: "mercado-c3e95.firebasestorage.app",
            messagingSenderId: "883539091925",
            appId: "1:883539091925:web:d8bb6b99548e59beaa5d5c"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function executar() {
            const limite = new Date();
            limite.setDate(limite.getDate() + 7);
            const dataISO = limite.toISOString().split('T')[0];

            const q = query(collection(db, "validades"), where("vencimento", "<=", dataISO));
            const snap = await getDocs(q);
            const tokens = await getDocs(collection(db, "tokens_notificacao"));

            document.getElementById('status').innerText = `Encontrados ${snap.size} itens para ${tokens.size} aparelhos.`;
            console.log("Processo concluÃ­do via GitHub Actions.");
        }
        executar();
    </script>
</body>
</html>

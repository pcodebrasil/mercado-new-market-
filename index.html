<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEW MARKET ULTRA - v2.0</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Inter:wght@400;700;900&display=swap');

        :root {
            --primary: #FFD700; /* Amarelo Shark */
            --danger: #FF3131;  /* Vermelho Alerta */
            --accent: #00D1FF;  /* Azul El√©trico */
            --bg-dark: #050505;
            --card-bg: #111111;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-dark); 
            color: #ffffff;
            -webkit-font-smoothing: antialiased;
        }

        .font-shark { font-family: 'Orbitron', sans-serif; }

        /* Estiliza√ß√£o Neomorfismo/Glassmorphism */
        .glass-header {
            background: rgba(17, 17, 17, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 3px solid var(--primary);
        }

        .card-premium {
            background: var(--card-bg);
            border-left: 4px solid var(--accent);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transition: transform 0.2s ease;
        }

        .card-premium:active { transform: scale(0.98); }

        .btn-shark-primary {
            background: var(--primary);
            color: #000;
            font-weight: 900;
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .btn-shark-danger {
            background: var(--danger);
            color: #fff;
            font-weight: 900;
            text-transform: uppercase;
        }

        /* Anima√ß√µes */
        .glow-yellow { box-shadow: 0 0 15px rgba(255, 215, 0, 0.4); }
        .glow-blue { box-shadow: 0 0 15px rgba(0, 209, 255, 0.4); }

        .status-badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 8px;
            font-weight: 900;
            text-transform: uppercase;
        }

        input::placeholder { color: #444; }
    </style>
</head>
<body oncontextmenu="return false;">

    <header class="glass-header sticky top-0 z-50 p-5 rounded-b-[2rem]">
        <div class="flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-yellow-400 rounded-lg flex items-center justify-center shadow-lg">
                    <span class="text-black font-shark font-black text-xl">N</span>
                </div>
                <div>
                    <h1 class="font-shark font-black text-lg tracking-tighter text-yellow-400">NEW MARKET <span class="text-white">ULTRA</span></h1>
                    <div class="flex items-center gap-2">
                        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                        <p id="user-display" class="text-[8px] font-bold uppercase text-gray-400 tracking-[0.2em]"></p>
                    </div>
                </div>
            </div>
            <button onclick="logout()" class="w-10 h-10 bg-white/5 rounded-full flex items-center justify-center border border-white/10">üö™</button>
        </div>

        <div class="grid grid-cols-4 gap-2 mt-6">
            <div class="bg-red-600/20 border border-red-600 p-2 rounded-xl text-center">
                <p class="text-[7px] font-black uppercase text-red-500">Vencidos</p>
                <p id="dash-vencidos" class="text-lg font-shark font-black">0</p>
            </div>
            <div class="bg-blue-600/20 border border-blue-600 p-2 rounded-xl text-center">
                <p class="text-[7px] font-black uppercase text-blue-400">7 Dias</p>
                <p id="dash-alerta" class="text-lg font-shark font-black">0</p>
            </div>
            <div class="bg-yellow-600/20 border border-yellow-600 p-2 rounded-xl text-center">
                <p class="text-[7px] font-black uppercase text-yellow-500">Estoque</p>
                <p id="dash-total" class="text-lg font-shark font-black">0</p>
            </div>
            <div class="bg-white/5 border border-white/10 p-2 rounded-xl text-center">
                <p class="text-[7px] font-black uppercase text-gray-400">Total</p>
                <p id="dash-global" class="text-lg font-shark font-black">0</p>
            </div>
        </div>
    </header>

    <main class="p-4 pb-32">
        <div class="relative mb-6">
            <input type="text" id="input-busca" oninput="renderizar()" placeholder="PESQUISAR PRODUTO..." 
                class="w-full bg-[#111] border-2 border-white/5 p-4 rounded-2xl text-white font-bold outline-none focus:border-yellow-400 transition-all">
            <span class="absolute right-4 top-4 opacity-30">üîç</span>
        </div>

        <div id="container-produtos" class="space-y-4">
            </div>
    </main>

    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] flex gap-2 z-[100]">
        <button onclick="abrirCadastro()" class="flex-[2] btn-shark-primary p-5 rounded-2xl flex items-center justify-center gap-3 text-sm">
            <span class="text-xl">üì∏</span> NOVO PRODUTO
        </button>
        <button onclick="enviarRelatorioWhatsApp()" class="flex-1 bg-green-500 rounded-2xl flex items-center justify-center shadow-lg shadow-green-500/20">
            <span class="text-2xl">üì±</span>
        </button>
    </nav>

    <div id="modal-cadastro" class="hidden fixed inset-0 bg-black z-[1000] p-6 overflow-y-auto">
        <div class="flex justify-between items-center mb-8">
            <h2 class="font-shark font-black text-yellow-400 text-xl">SCANNER / INPUT</h2>
            <button onclick="fecharModalCadastro()" class="text-4xl text-gray-500">&times;</button>
        </div>

        <div id="reader-container" class="hidden relative w-full aspect-square bg-[#111] rounded-[2rem] overflow-hidden mb-6 border-2 border-yellow-400/30 shadow-2xl">
            <div id="reader"></div>
        </div>

        <div class="space-y-4">
            <div class="group">
                <label class="text-[10px] font-black text-yellow-400 ml-2">C√ìDIGO DE BARRAS</label>
                <input type="text" id="p-ean" class="w-full p-4 bg-[#111] rounded-xl border border-white/10 text-yellow-400 font-mono">
            </div>
            <div class="group">
                <label class="text-[10px] font-black text-blue-400 ml-2">DESCRI√á√ÉO DO PRODUTO</label>
                <input type="text" id="p-nome" class="w-full p-4 bg-[#111] rounded-xl border border-white/10 text-white font-bold uppercase">
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-[10px] font-black text-white/40 ml-2">VALIDADE</label>
                    <input type="date" id="p-validade" class="w-full p-4 bg-[#111] rounded-xl border border-white/10 text-white">
                </div>
                <div>
                    <label class="text-[10px] font-black text-white/40 ml-2">QUANTIDADE</label>
                    <input type="tel" id="p-qtd" class="w-full p-4 bg-[#111] rounded-xl border border-white/10 text-yellow-400 font-black text-center text-xl">
                </div>
            </div>
            <input type="hidden" id="edit-id">
            <button onclick="salvarProduto()" class="w-full py-6 btn-shark-primary rounded-2xl mt-8 text-lg">SALVAR NO SISTEMA</button>
        </div>
    </div>

    <div id="loginView" class="fixed inset-0 bg-black z-[2000] flex flex-col p-10 justify-center">
        <div class="text-center mb-10">
            <div class="w-24 h-24 bg-yellow-400 rounded-3xl mx-auto flex items-center justify-center rotate-12 shadow-2xl shadow-yellow-400/20 mb-6">
                <span class="text-black font-shark font-black text-5xl -rotate-12">N</span>
            </div>
            <h1 class="font-shark font-black text-3xl tracking-tighter">NEW MARKET <span class="text-yellow-400">ULTRA</span></h1>
            <p class="text-gray-500 font-bold text-[10px] mt-2 tracking-[0.5em]">OPERATIONAL SYSTEM</p>
        </div>
        <div id="auth-container" class="space-y-3"></div>
    </div>

    <script>
        // ... (Mantemos a l√≥gica do Firebase e Fun√ß√µes do seu c√≥digo anterior)
        // Adicionamos apenas a nova renderiza√ß√£o visual para os cards.

        function renderizar() {
            const container = document.getElementById('container-produtos');
            const busca = document.getElementById('input-busca').value.toUpperCase();
            const hoje = new Date().setHours(0,0,0,0);
            
            let html = '';
            estoque.forEach(item => {
                const dV = new Date(item.vencimento + 'T00:00:00');
                const diffDays = Math.floor((dV - hoje) / 86400000);
                
                if (item.produto.includes(busca) || (item.ean || "").includes(busca)) {
                    const statusClass = diffDays < 0 ? 'border-red-600' : diffDays <= 7 ? 'border-yellow-500' : 'border-blue-500';
                    const badge = diffDays < 0 ? '<span class="bg-red-600 status-badge">VENCIDO</span>' : diffDays <= 7 ? '<span class="bg-yellow-500 status-badge text-black">ALERTA</span>' : '';

                    html += `
                        <div class="card-premium p-5 rounded-3xl ${statusClass}">
                            <div class="flex justify-between items-start">
                                <div class="flex-grow">
                                    <div class="flex items-center gap-2 mb-1">${badge}<span class="text-[9px] font-black text-gray-500">${item.ean || 'SEM COD'}</span></div>
                                    <h3 class="text-lg font-black leading-tight uppercase text-white">${item.produto}</h3>
                                </div>
                                <div class="text-right">
                                    <p class="text-[10px] font-black text-white/40 uppercase">Vence em</p>
                                    <p class="text-xl font-shark font-black ${diffDays < 0 ? 'text-red-500' : 'text-white'}">
                                        ${item.vencimento.split('-').reverse().join('/')}
                                    </p>
                                </div>
                            </div>
                            <div class="mt-4 pt-4 border-t border-white/5 flex justify-between items-center">
                                <div class="flex items-center gap-4">
                                    <div class="text-center">
                                        <p class="text-[8px] font-black text-gray-500 uppercase">Qtd</p>
                                        <p class="text-2xl font-black text-yellow-400">${item.quantidade}</p>
                                    </div>
                                    <div class="w-[2px] h-8 bg-white/10"></div>
                                    <div>
                                        <p class="text-[8px] font-black text-gray-500 uppercase">Operador</p>
                                        <p class="text-[10px] font-bold text-blue-400">${item.operador}</p>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick='prepararEdicao(${JSON.stringify(item)})' class="bg-white/5 p-3 rounded-xl text-[10px] font-black uppercase">Editar</button>
                                    <button onclick="excluirProduto('${item.id}', '${item.produto}')" class="bg-red-600/10 p-3 rounded-xl text-[10px] font-black uppercase text-red-500">Excluir</button>
                                </div>
                            </div>
                        </div>
                    `;
                }
            });
            container.innerHTML = html;
            // Atualizar contadores do header...
        }

        // ... (O restante das fun√ß√µes de Firebase e L√≥gica de Usu√°rios permanecem as mesmas para manter a estabilidade)
    </script>
</body>
</html>

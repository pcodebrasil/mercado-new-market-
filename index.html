<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>New Market - Sistema 2026</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

<style>
#login-screen,#main-panel{display:none}
#loading-screen{position:fixed;inset:0;background:#fff;z-index:999;display:flex;flex-direction:column;align-items:center;justify-content:center}
.filter-active{border-width:4px!important;opacity:1!important;transform:scale(1.05);transition:.3s}
.filter-inactive{opacity:.6}
.card-critico{border-left:8px solid #ef4444}
.card-atencao{border-left:8px solid #f59e0b}
.card-normal{border-left:8px solid #10b981}
.card-checked{opacity:.4;filter:grayscale(1);background:#f1f5f9!important;border-left-color:#94a3b8!important;transform:scale(.96)}
.bg-newmarket{background:linear-gradient(135deg,#1e40af 0%,#dc2626 50%,#facc15 100%)}
.btn-newmarket{background:linear-gradient(90deg,#1e40af,#dc2626,#facc15);background-size:200% auto;transition:.5s}
#toast{visibility:hidden;min-width:250px;background:#333;color:#fff;text-align:center;border-radius:12px;padding:16px;position:fixed;z-index:1000;left:50%;bottom:30px;transform:translateX(-50%);font-weight:700;font-size:10px}
#toast.show{visibility:visible;animation:fadein .5s,fadeout .5s 2.5s}
@keyframes fadein{from{bottom:0;opacity:0}to{bottom:30px;opacity:1}}
@keyframes fadeout{from{bottom:30px;opacity:1}to{bottom:0;opacity:0}}
svg.barcode{width:100%;max-height:55px}
.dev-footer{font-size:9px;font-weight:900;text-transform:uppercase;letter-spacing:1px;color:#94a3b8;margin-top:20px;padding-bottom:10px}
</style>
</head>

<body class="bg-slate-100 font-sans text-slate-900 flex flex-col min-h-screen">

<div id="toast"></div>

<div id="loading-screen">
<div class="w-12 h-12 border-4 border-blue-800 border-t-red-600 rounded-full animate-spin mb-4"></div>
<p class="text-[10px] font-black uppercase text-slate-400 tracking-[0.2em]">Sincronizando New Market</p>
</div>

<div id="login-screen" class="flex-grow flex flex-col items-center justify-center p-4">
<div class="bg-white p-8 rounded-[2.5rem] shadow-2xl w-full max-w-md border-t-8 border-blue-800 text-center">
<h1 class="text-3xl font-black uppercase italic text-blue-800">New <span class="text-red-600">Market</span></h1>
<p class="text-[10px] text-yellow-600 font-black uppercase tracking-widest mt-1">Nazaré Paulista</p>

<form id="login-form" class="space-y-4 mt-8">
<input type="email" id="email" class="w-full p-4 border rounded-2xl bg-slate-50 outline-none" placeholder="E-mail" required>
<input type="password" id="password" class="w-full p-4 border rounded-2xl bg-slate-50 outline-none" placeholder="Senha" required>
<button class="w-full btn-newmarket text-white p-4 rounded-2xl font-black uppercase shadow-lg">Acessar Painel</button>
</form>
</div>
<footer class="dev-footer">Desenvolvido por Paulo Souza • 2026</footer>
</div>

<div id="main-panel" class="flex-grow flex flex-col">
<nav class="bg-newmarket text-white p-4 flex justify-between items-center sticky top-0 z-50 shadow-md">
<div>
<span class="font-black italic uppercase text-lg">New Market</span><br>
<span id="user-display" class="text-[8px] font-black uppercase tracking-widest text-yellow-200"></span>
</div>
<button id="btn-logout" class="text-[8px] bg-black/40 px-3 py-2 rounded-full uppercase font-bold border border-white/20">Sair</button>
</nav>

<main class="p-4 max-w-xl mx-auto w-full flex-grow space-y-4">
<div id="lista" class="space-y-3"></div>
</main>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyAJaG7s34jBoU61fNNZieeV3N6lh9_3vo4",
authDomain:"mercado-c3e95.firebaseapp.com",
projectId:"mercado-c3e95",
storageBucket:"mercado-c3e95.firebasestorage.app",
messagingSenderId:"883539091925",
appId:"1:883539091925:web:d8bb6b99548e59beaa5d5c"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

function showToast(msg,color="#333"){
const t=document.getElementById("toast");
t.innerText=msg;t.style.backgroundColor=color;t.className="show";
setTimeout(()=>t.className="",3000);
}

onAuthStateChanged(auth,user=>{
document.getElementById("loading-screen").style.display="none";
if(user){
document.getElementById("login-screen").style.display="none";
document.getElementById("main-panel").style.display="flex";
document.getElementById("user-display").innerText=user.email;
carregar();
}else{
document.getElementById("login-screen").style.display="flex";
}
});

document.getElementById("login-form").onsubmit=async e=>{
e.preventDefault();
try{
await signInWithEmailAndPassword(auth,email.value,password.value);
}catch{
showToast("Login inválido","#dc2626");
}
};

document.getElementById("btn-logout").onclick=()=>signOut(auth);

function carregar(){
onSnapshot(query(collection(db,"validades"),orderBy("vencimento","asc")),snap=>{
const lista=document.getElementById("lista");
lista.innerHTML="";
snap.forEach(d=>{
const item=d.data();
const diff=Math.ceil((new Date(item.vencimento+"T00:00:00")-new Date().setHours(0,0,0,0))/86400000);

let estilo="card-normal",cor="text-green-600";
if(diff<=7){estilo="card-critico";cor="text-red-600 animate-pulse font-black";}
else if(diff<=15){estilo="card-atencao";cor="text-yellow-600 font-black";}

const div=document.createElement("div");
div.className=`p-4 bg-white rounded-2xl shadow ${estilo}`;
div.innerHTML=`
<div class="flex justify-between text-[8px] font-black text-slate-400">
<span>${item.setor}</span>
<span class="${cor}">
${diff<=0 ? '❌ VENCIDO' : diff+' DIAS'}
</span>
</div>
<h3 class="font-black uppercase text-sm mt-1">${item.produto}</h3>
<p class="text-[9px] font-bold text-slate-500 mt-1">
Qtd: ${item.quantidade} | Venc: ${item.vencimento.split('-').reverse().join('/')}
</p>`;
lista.appendChild(div);
});
});
}
</script>
</body>
</html>

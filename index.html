<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>New Market - Gest√£o de Validade</title>

    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignal.js" defer></script>
    <script>
      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function(OneSignal) {
        await OneSignal.init({
          appId: "b506dbfa-b632-41c1-a56c-c3ed0ac2c709",
          safari_web_id: "web.onesignal.auto.63584824-3450-4886-9818-875654",
          notifyButton: { enable: false },
        });
      });
    </script>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <style>
        :root { --primary: #2563eb; --danger: #dc2626; --warning: #f59e0b; --success: #16a34a; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
        body { background: var(--bg); color: var(--text); padding-bottom: 80px; }
        #login-screen { position: fixed; inset: 0; background: var(--primary); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .login-card { background: white; padding: 2rem; border-radius: 1rem; width: 90%; max-width: 400px; text-align: center; }
        input { width: 100%; padding: 0.8rem; margin-bottom: 1rem; border: 1px solid #ddd; border-radius: 0.5rem; outline: none; }
        button { width: 100%; padding: 0.8rem; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-purple { background: #6b21a8; color: white; margin-top: 1rem; }
        header { background: var(--primary); color: white; padding: 1rem; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        .container { padding: 1rem; max-width: 800px; margin: 0 auto; }
        .card { background: var(--card); padding: 1rem; border-radius: 0.75rem; margin-bottom: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border-left: 5px solid #ddd; }
        .status-vencido { border-left-color: var(--danger); background: #fef2f2; }
        .status-critico { border-left-color: var(--warning); background: #fffbeb; }
        .status-ok { border-left-color: var(--success); }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 200; }
        .modal-content { background: white; padding: 1.5rem; border-radius: 1rem; width: 90%; max-width: 500px; }
        nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; justify-content: space-around; padding: 1rem; border-top: 1px solid #ddd; }
        nav button { background: none; color: #64748b; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-card">
            <h2 style="color:var(--primary); margin-bottom:1rem;">New Market</h2>
            <input type="email" id="email" placeholder="E-mail">
            <input type="password" id="password" placeholder="Senha">
            <button class="btn-primary" onclick="login()">Entrar no Sistema</button>
        </div>
    </div>

    <header>
        <span id="user-display">Carregando...</span>
        <button onclick="document.getElementById('modal-config').style.display='flex'" style="background:none; font-size: 1.5rem;">‚öôÔ∏è</button>
    </header>

    <div class="container" id="lista-produtos"></div>

    <nav>
        <button onclick="carregarProdutos()">üìã Lista</button>
        <button onclick="document.getElementById('modal-add').style.display='flex'">‚ûï Lan√ßar</button>
        <button onclick="logout()">üö™ Sair</button>
    </nav>

    <div id="modal-add" class="modal">
        <div class="modal-content">
            <h3>Lan√ßar Produto</h3><br>
            <input type="text" id="prod-nome" placeholder="Nome do Produto">
            <input type="date" id="prod-validade">
            <input type="text" id="prod-setor" placeholder="Setor">
            <button class="btn-primary" onclick="salvarProduto()">Salvar</button>
            <button onclick="this.parentElement.parentElement.style.display='none'" style="margin-top:0.5rem; background:none;">Cancelar</button>
        </div>
    </div>

    <div id="modal-config" class="modal">
        <div class="modal-content">
            <h3>Configura√ß√µes</h3><br>
            <button class="btn-purple" onclick="OneSignalDeferred.push(function(o){o.showNativePrompt()})">üîî Ativar Alertas no Celular</button>
            <button onclick="this.parentElement.parentElement.style.display='none'" style="margin-top:1rem; background:#ddd;">Fechar</button>
        </div>
    </div>

    <script>
        // DADOS REAIS DA SUA FOTO 910.JPG
        const firebaseConfig = {
            apiKey: "AIzaSyAJaG7s34jBoU61fNNZIeeV3...", // Copiado da sua foto
            authDomain: "mercado-c3e95.firebaseapp.com",
            projectId: "mercado-c3e95",
            storageBucket: "mercado-c3e95.firebasestorage.app",
            messagingSenderId: "883539091925",
            appId: "1:883539091925:web:d8bb6b99548e59beaa5d5c"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        function login() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            auth.signInWithEmailAndPassword(email, pass).catch(err => alert("Erro: " + err.message));
        }

        function logout() { auth.signOut().then(() => location.reload()); }

        function salvarProduto() {
            const nome = document.getElementById('prod-nome').value;
            const validade = document.getElementById('prod-validade').value;
            const setor = document.getElementById('prod-setor').value;
            db.collection("produtos").add({
                nome, validade, setor,
                usuario: auth.currentUser.email,
                data: new Date().toISOString()
            }).then(() => {
                document.getElementById('modal-add').style.display = 'none';
                carregarProdutos();
            });
        }

        function carregarProdutos() {
            db.collection("produtos").orderBy("validade", "asc").onSnapshot(snap => {
                const lista = document.getElementById('lista-produtos');
                lista.innerHTML = "";
                snap.forEach(doc => {
                    const p = doc.data();
                    lista.innerHTML += `<div class="card"><strong>${p.nome}</strong><br>${p.validade} <button onclick="db.collection('produtos').doc('${doc.id}').delete()" style="float:right; background:none;">üóëÔ∏è</button></div>`;
                });
            });
        }

        auth.onAuthStateChanged(user => {
            if(user) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('user-display').innerText = user.email;
                carregarProdutos();
            }
        });
    </script>
</body>
</html>

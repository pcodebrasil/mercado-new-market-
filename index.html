<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>New Market</title>

<!-- Firebase (compat estável) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
* {
  box-sizing: border-box;
  font-family: Arial, sans-serif;
}

body {
  margin: 0;
  background: #0a3d62;
}

/* LOGIN */
#login {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

.login-box {
  background: #fff;
  width: 90%;
  max-width: 360px;
  padding: 20px;
  border-radius: 12px;
}

.login-box h2 {
  text-align: center;
}

select, input, button {
  width: 100%;
  padding: 14px;
  margin-top: 10px;
  font-size: 16px;
}

button {
  background: #f1c40f;
  border: none;
  font-weight: bold;
}

/* APP */
#app {
  display: none;
  min-height: 100vh;
  background: #f4f6f8;
}

header {
  background: #0a3d62;
  color: #fff;
  padding: 15px;
}

main {
  padding: 15px;
}

.card {
  background: #fff;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 10px;
}

.actions {
  margin-top: 10px;
}

.actions button {
  margin-right: 8px;
}

.fab {
  position: fixed;
  bottom: 20px;
  left: 20px;
  right: 20px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login">
  <div class="login-box">
    <h2>New Market</h2>
    <select id="usuario"></select>
    <input type="password" id="senha" placeholder="Senha">
    <button onclick="login()">Entrar</button>
  </div>
</div>

<!-- APP -->
<div id="app">
  <header>
    <h3 id="infoUsuario"></h3>
  </header>

  <main id="lista"></main>

  <div class="fab">
    <button onclick="adicionar()">+ Cadastrar Produto</button>
  </div>
</div>

<script>
/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_PROJETO.firebaseapp.com",
  projectId: "SEU_PROJETO"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ================= USUÁRIOS ================= */
const usuarios = {
  Adriano:   { senha: "1234", cargo: "GERENTE" },
  Adrielle: { senha: "1234", cargo: "GERENTE" },
  Paulo:    { senha: "1234", cargo: "FUNCIONÁRIO" },
  Pedro:    { senha: "1234", cargo: "FUNCIONÁRIO" },
  Leandro:  { senha: "1234", cargo: "FUNCIONÁRIO" },
  Edmar:    { senha: "1234", cargo: "FUNCIONÁRIO" },
  João:     { senha: "1234", cargo: "FUNCIONÁRIO" },
  Tamiris:  { senha: "1234", cargo: "FUNCIONÁRIO" }
};

let usuarioAtual = null;

/* ================= LOGIN ================= */
const selectUsuario = document.getElementById("usuario");
selectUsuario.innerHTML = `<option value="">Selecione</option>`;

Object.keys(usuarios).forEach(nome => {
  const opt = document.createElement("option");
  opt.value = nome;
  opt.textContent = nome;
  selectUsuario.appendChild(opt);
});

function login() {
  const nome = selectUsuario.value;
  const senha = document.getElementById("senha").value;

  if (!usuarios[nome] || usuarios[nome].senha !== senha) {
    alert("Usuário ou senha inválidos");
    return;
  }

  usuarioAtual = nome;
  document.getElementById("infoUsuario").innerText =
    `${nome} (${usuarios[nome].cargo})`;

  document.getElementById("login").style.display = "none";
  document.getElementById("app").style.display = "block";

  carregarProdutos();
}

/* ================= PRODUTOS ================= */
function carregarProdutos() {
  db.collection("produtos").onSnapshot(snapshot => {
    const lista = document.getElementById("lista");
    lista.innerHTML = "";

    snapshot.forEach(doc => {
      const p = doc.data();

      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <b>${p.nome}</b><br>
        Validade: ${p.validade || "-"}<br>
        Quantidade: ${p.quantidade ?? 0}
        <div class="actions">
          <button onclick="editar('${doc.id}', ${p.quantidade ?? 0})">Editar</button>
          <button onclick="excluir('${doc.id}')">Excluir</button>
        </div>
      `;
      lista.appendChild(card);
    });
  });
}

function adicionar() {
  const nome = prompt("Nome do produto:");
  if (!nome) return;

  const validade = prompt("Validade:");
  const quantidade = Number(prompt("Quantidade:") || 0);

  db.collection("produtos").add({
    nome,
    validade,
    quantidade
  });
}

function editar(id, atual) {
  const nova = Number(prompt("Nova quantidade:", atual));
  if (isNaN(nova)) return;

  db.collection("produtos").doc(id).update({
    quantidade: nova
  });
}

function excluir(id) {
  if (usuarios[usuarioAtual].cargo !== "GERENTE") {
    alert("Somente gerentes podem excluir");
    return;
  }
  db.collection("produtos").doc(id).delete();
}
</script>

</body>
</html>
